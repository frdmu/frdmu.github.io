---
layout: post
title: Google File System 
date: 2021-06-14
tags: MIT-6.824 
---
# Architecture
&ensp;&ensp;A GFS cluster consists of a single master and multiple chunkservers and is accessed by multiple clients, as shown in Figure 1.
![](/images/posts/fig1.png) 
## 1. Single Master
&ensp;&ensp;Having a single master enables the master to make sophisticated chunk placement and replication decisions using global knowledge.
## 2. Chunk Size
&ensp;&ensp;Chunk size is one of the key design parameters. It has been chosen 64 MB, which is much larger than typical file system block sizes. Each chunk replica is stored as a plain Linux file on a chunkserver and is extended only as needed.
## 3. Metadata
&ensp;&ensp;The master stores three major types of metadata: 
- the file and chunk namespaces 
- the mapping from files to chunks
- the locations of each chunk’s replicas

&ensp;&ensp;All metadata is kept in the master’s memory.

&ensp;&ensp;The first two types (namespaces and file-to-chunk mapping) are also kept persistent by logging mutations to an operation log stored on the master’s local disk and replicated on remote machines.

&ensp;&ensp;But the master does not store chunk location information persistently.
### 3.1 In-Memory Data Structures
&ensp;&ensp;The master maintains less than 64 bytes of metadata for each 64 MB chunk.
### 3.2 Chunk Locations
&ensp;&ensp;The master does not keep a persistent record of which chunkservers have a replica of a given chunk.It simply polls chunkservers for that information at startup. The master can keep itself up-to-date thereafter because it controls all chunk placement and monitors chunkserver status with regular HeartBeat messages.
### 3.3 Operation Log
&ensp;&ensp;The operation log contains a historical record of critical metadata changes.

&ensp;&ensp;We replicate it on multiple remote machines and respond to a client operation only after flushing the corresponding log record to disk both locally and remotely.

&ensp;&ensp;The master recovers its file system state by replaying the operation log.To minimize startup time, we must keep the log small. The master checkpoints its state whenever the log grows beyond a certain size so that it can recover by loading the latest checkpoint from local disk and replaying only the limited number of log records after that.The checkpoint is in a compact B-tree like form that can be directly mapped into memory and used for namespace lookup without extra parsing. 
## 4. Consistency Model
&ensp;&ensp;GFS has a relaxed consistency model that supports highly distributed applications well but remains relatively simple and efficient to implement. 

## 5. Reference
[Google File System](https://pdos.csail.mit.edu/6.824/papers/gfs.pdf)
